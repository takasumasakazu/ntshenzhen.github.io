<!-- OVERRIDE_HOME_INDEX_ENABLED -->
{{- define "main" -}}

  {{- /* Collect pages across these sections (URL維持のため固定) */ -}}
  {{- $pages := where .Site.RegularPages "Section" "in" (slice "teardown" "shenzhen" "fabcross" "archive") -}}
  {{- $pages = where $pages "Params.hiddenInHomeList" "ne" true -}}
  {{- $pages = $pages.ByDate.Reverse -}}

  {{- /* Optional: PaperMod profile/home-info block */ -}}
  {{- if site.Params.profileMode -}}
    {{- partial "profile.html" . -}}
  {{- else -}}
    {{- with site.Params.homeInfoParams -}}
      {{- partial "home_info.html" $ -}}
    {{- end -}}
  {{- end -}}

  {{- /* First view: latest 3 posts */ -}}
  {{- $top := first 3 $pages -}}
  {{- if gt (len $top) 0 -}}
    <div class="first-entry home-info">
      {{- range $top -}}
        {{- partial "post_entry.html" . -}}
      {{- end -}}
    </div>
  {{- end -}}

  {{- /* Rest with pagination */ -}}
  {{- $rest := after 3 $pages -}}
  {{- $paginator := .Paginate $rest -}}

  {{- range $paginator.Pages -}}
    {{- partial "post_entry.html" . -}}
  {{- end -}}

  {{- partial "pagination.html" . -}}

{{- end -}}
